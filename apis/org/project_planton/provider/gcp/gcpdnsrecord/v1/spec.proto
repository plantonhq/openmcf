syntax = "proto3";

package org.project_planton.provider.gcp.gcpdnsrecord.v1;

import "buf/validate/validate.proto";
import "org/project_planton/shared/foreignkey/v1/foreign_key.proto";
import "org/project_planton/shared/networking/enums/dnsrecordtype/dns_record_type.proto";
import "org/project_planton/shared/options/options.proto";

// GcpDnsRecordSpec defines the configuration for creating a DNS record in a Google Cloud DNS Managed Zone.
// This component creates individual DNS records (A, AAAA, CNAME, MX, TXT, etc.) within an existing zone.
message GcpDnsRecordSpec {
  // The ID of the GCP project where the Managed Zone exists.
  // This is used to locate the DNS zone where the record will be created.
  org.project_planton.shared.foreignkey.v1.StringValueOrRef project_id = 1 [
    (buf.validate.field).required = true,
    (org.project_planton.shared.foreignkey.v1.default_kind) = GcpProject,
    (org.project_planton.shared.foreignkey.v1.default_kind_field_path) = "status.outputs.project_id"
  ];

  // The name of the Managed Zone where this DNS record will be created.
  // This must be an existing Cloud DNS Managed Zone in the specified project.
  // Example: "example-zone" (the zone name, not the DNS name).
  string managed_zone = 2 [
    (buf.validate.field).required = true,
    (buf.validate.field).cel = {
      id: "managed_zone.valid_name"
      message: "managed_zone must be a valid Cloud DNS zone name (lowercase letters, numbers, and hyphens)"
      expression: "this.matches('^[a-z][a-z0-9-]{0,62}$')"
    }
  ];

  // The DNS record type to create.
  // Supported types: A, AAAA, CNAME, MX, TXT, SRV, NS, PTR, CAA, SOA.
  org.project_planton.shared.networking.enums.dnsrecordtype.DnsRecordType record_type = 3 [
    (buf.validate.field).required = true,
    (buf.validate.field).enum.defined_only = true,
    (buf.validate.field).cel = {
      id: "record_type.not_unspecified"
      message: "record_type must be specified (cannot be unspecified)"
      expression: "this != 0"
    }
  ];

  // The fully qualified domain name for this record.
  // Must end with a trailing dot to indicate FQDN.
  // Example: "www.example.com." or "api.example.com."
  string name = 4 [
    (buf.validate.field).required = true,
    (buf.validate.field).cel = {
      id: "name.valid_fqdn"
      message: "name must be a valid DNS domain name ending with a trailing dot (e.g., www.example.com.)"
      expression: "this.endsWith('.') && this.matches('^(?:[*][.])?(?:[_a-z0-9](?:[_a-z0-9-]{0,61}[a-z0-9])?[.])+$')"
    }
  ];

  // The values/targets for the DNS record.
  // For A records: IPv4 addresses (e.g., "192.0.2.1")
  // For AAAA records: IPv6 addresses (e.g., "2001:db8::1")
  // For CNAME records: target hostname with trailing dot (e.g., "target.example.com.")
  // For MX records: mail server with priority (priority handled separately)
  // For TXT records: text values (e.g., "v=spf1 include:_spf.google.com ~all")
  // Multiple values create a round-robin record set.
  repeated string values = 5 [(buf.validate.field).repeated.min_items = 1];

  // Time to live (TTL) for the DNS record in seconds.
  // Determines how long resolvers should cache this record.
  // Common values: 60 (1 min), 300 (5 min), 3600 (1 hour), 86400 (1 day).
  // Default: 300 seconds (5 minutes).
  optional int32 ttl_seconds = 6 [
    (org.project_planton.shared.options.default) = "300",
    (buf.validate.field).int32 = {
      gte: 1
      lte: 86400
    }
  ];
}
